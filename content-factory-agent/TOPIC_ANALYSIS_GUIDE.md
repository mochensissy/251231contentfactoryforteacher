# 选题分析功能使用指南

## 功能说明

选题分析功能已成功集成真实的公众号文章API，可以根据关键词获取公众号文章并进行数据分析。

## API集成

### 1. 公众号文章API
**文件位置**: `app/api/wechat-articles/route.ts`

**功能**:
- 根据关键词搜索公众号文章
- 支持时间范围筛选（默认7天）
- 返回文章标题、正文、阅读数、点赞数、在看数等数据

**API Key**: `JZL34baea50c020a325`

**请求示例**:
```javascript
POST /api/wechat-articles
{
  "keyword": "AI",
  "page": 1,
  "period": 7
}
```

**响应示例**:
```javascript
{
  "success": true,
  "data": [
    {
      "title": "文章标题",
      "content": "正文内容",
      "read": 10000,
      "praise": 500,
      "looking": 200,
      "url": "文章链接",
      "wx_name": "公众号名称"
      // ... 其他字段
    }
  ],
  "total": 50,
  "page": 1,
  "totalPage": 5
}
```

### 2. AI分析API
**文件位置**: `app/api/analyze/route.ts`

**功能**:
- 分析文章数据，生成洞察报告
- 计算点赞TOP5
- 计算互动率TOP5
- 提取高频词云
- 生成选题洞察建议

**请求示例**:
```javascript
POST /api/analyze
{
  "articles": [
    // 公众号文章数组
  ]
}
```

**响应示例**:
```javascript
{
  "success": true,
  "data": {
    "topLikesArticles": [...],
    "topEngagementArticles": [...],
    "wordCloud": [...],
    "insights": [...]
  }
}
```

## 使用流程

### 1. 启动项目
```bash
cd content-factory-agent
npm run dev
```

### 2. 访问选题分析页面
打开浏览器访问: http://localhost:3000/topic-analysis

### 3. 输入关键词
在输入框中输入你想分析的关键词，例如：
- AI
- 内容创作
- 自媒体
- ChatGPT
- 视频号

### 4. 查看分析结果
点击"开始分析"按钮后，系统会：
1. 调用公众号文章API获取相关文章（20%进度）
2. 显示获取到的文章数量（50%进度）
3. 进行数据分析（70%进度）
4. 生成洞察报告（90%进度）
5. 展示完整报告（100%）

### 5. 查看报告内容
报告包含4个Tab:
- **点赞TOP5**: 点赞数最高的5篇文章
- **互动率TOP5**: 互动率最高的5篇文章
- **高频词云**: 从所有文章中提取的关键词
- **选题洞察**: 5个AI生成的选题建议

## 核心功能实现

### 1. 互动率计算
```typescript
互动率 = (点赞数 + 在看数) / 阅读数 × 100%
```

### 2. 高频词提取
- 从文章标题和正文中提取2-4字的中文词组
- 过滤常见停用词
- 按出现频率排序
- 归一化权重（0-100）

### 3. 洞察生成
基于以下维度生成选题建议：
- 高点赞文章的主题分析
- 高互动率文章的特点
- 原创内容占比
- 高频关键词组合

## 文件结构

```
app/
├── api/
│   ├── wechat-articles/
│   │   └── route.ts          # 公众号文章API
│   └── analyze/
│       └── route.ts           # AI分析API
├── topic-analysis/
│   └── page.tsx              # 选题分析页面
lib/
└── types.ts                  # TypeScript类型定义
```

## 注意事项

### 1. API额度
- 公众号文章API有调用次数限制
- 每次分析会消耗一定金额（在响应中返回）
- 建议合理使用，避免频繁调用

### 2. 错误处理
已实现的错误处理：
- 关键词为空提示
- API请求失败提示
- 未找到文章提示
- 网络错误提示

### 3. 性能优化建议
- 默认只获取第1页数据（通常10-20篇文章）
- 可以通过修改`page`参数获取更多文章
- 分析过程有进度显示，提升用户体验

## 后续优化方向

1. **增强AI分析**
   - 接入OpenAI API进行更智能的洞察生成
   - 添加文章摘要功能
   - 优化关键词提取算法

2. **保存历史记录**
   - 将分析结果保存到数据库
   - 实现历史记录查看功能
   - 支持导出分析报告

3. **更多筛选选项**
   - 支持时间范围选择
   - 支持按分类筛选
   - 支持排序方式选择

4. **可视化增强**
   - 使用专业词云库（如wordcloud2.js）
   - 添加图表展示趋势
   - 优化移动端显示

## 测试建议

### 测试关键词推荐
1. **热门关键词**: AI、ChatGPT、人工智能
2. **行业关键词**: 内容创作、自媒体、视频号
3. **垂直领域**: 编程、设计、营销

### 预期结果
- 应该能获取到10-50篇相关文章
- 分析报告应包含完整的TOP5列表
- 词云应该能反映主题关键词
- 洞察建议应该与关键词相关

## 故障排查

### 问题1: API调用失败
检查：
- 网络连接是否正常
- API Key是否正确
- 服务器是否可访问

### 问题2: 未找到文章
建议：
- 更换其他关键词
- 增加时间范围（修改period参数）
- 检查关键词是否过于冷门

### 问题3: 进度卡住
刷新页面重试，或检查：
- 浏览器控制台是否有错误
- 网络请求是否超时
- 服务器日志是否有异常
